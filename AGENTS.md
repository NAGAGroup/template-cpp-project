# Agent Guidelines for template-cpp-project

## Environment Setup

This project uses **pixi** for dependency management. Available development environments:

| Environment | Platform | Toolchain | Description |
|-------------|----------|-----------|-------------|
| `dev-linux-clang` | Linux | Clang 18 | Linux development with Clang |
| `dev-linux-gcc` | Linux | GCC 13 | Linux development with GCC |
| `dev-win-clang` | Windows | Clang 18 | Windows development with Clang |
| `dev-win-msvc` | Windows | MSVC 2022 | Windows development with MSVC |
| `dev` | All | Clang | Convenience alias (platform-appropriate Clang) |
| `test` | All | Clang | Test-only environment (for CI) |
| `user` | All | Clang | User environment for consumers |

```bash
# Activate development environment (choose one)
pixi shell -e dev-linux-clang   # Linux with Clang
pixi shell -e dev-linux-gcc     # Linux with GCC
pixi shell -e dev               # Platform-appropriate Clang (convenience)
```

## Quick Commands

**Configure & Build (Dev Mode):**
```bash
pixi run -e dev-linux-clang configure   # Run cmake configure
pixi run -e dev-linux-clang build       # Build project (depends-on configure)
pixi run -e dev-linux-clang ctest --test-dir build/dev  # Run all tests
```

**Run Single Test:**
```bash
pixi run -e dev-linux-clang ctest --test-dir build/dev -R template-cpp-project_test -V
```

**Format & Lint:**
```bash
pixi run -e dev-linux-clang cmake --build build/dev -t format-fix   # Fix formatting
pixi run -e dev-linux-clang cmake --build build/dev -t spell-fix    # Fix spelling
pixi run -e dev-linux-clang cmake --build build/dev -t clang-tidy   # Run clang-tidy
```

**Project Management:**
```bash
pixi run -e project-mgmt change-project-name  # Rename project (interactive)
```

**Build Conda Package:**
```bash
pixi build                                      # Build with Clang (default)
rattler-build build -r recipe/recipe.yaml --variant-config recipe/variants-linux-gcc.yaml  # GCC variant
```

## Code Style Guidelines

**Formatting:** Enforced via `.clang-format` (Chromium-based with 2-space indents, 80-char limit).

**Naming Conventions:**
- Classes/Structs: `lower_case` (e.g., `exported_class`)
- Functions/Methods: `lower_case` (e.g., `my_function()`)
- Private Members: `m_lower_case` prefix (e.g., `m_name`)
- Constants: `UPPER_CASE` for macros, `lower_case` for const variables
- Template Parameters: `CamelCase` (e.g., `typename T`)

**Imports & Headers:**
1. Standard library first: `<algorithm>`, `<string>`, etc.
2. Library headers next: `<fmt/core.h>`
3. Project headers last: `"template-cpp-project/..."`
4. Separate groups with blank lines (enforced by clang-format)

**Symbol Export for Shared Libraries:**
- Use `TEMPLATE_CPP_PROJECT_EXPORT` macro on classes/functions exported from the library
- Include `"template-cpp-project/template-cpp-project_export.hpp"` (generated by CMake)
- Example: `class TEMPLATE_CPP_PROJECT_EXPORT exported_class { ... };`

**Type Safety:**
- Use `auto` with explicit casts when needed
- Prefer `std::string` over raw char arrays
- Use `const` liberally (enforced by clang-tidy)
- Trailing return types preferred: `auto func() -> int`

**Error Handling:**
- Exceptions encouraged (C++ standard exceptions)
- Constructor failures via exceptions
- No void returns for error conditions; use exceptions or optional
- clang-tidy enforces Modern C++ practices (C++17+)

**Code Quality:**
- Enable `template-cpp-project_DEVELOPER_MODE` for development
- All code must pass clang-tidy checks (`.clang-tidy` config enforced)
- Use `catch_discover_tests()` for new test files (Catch2 framework)
- Private members use `m_` prefix; protected members also use `m_` prefix

## Build System Details

- **CMake 3.24+** required (managed by pixi)
- **Presets:** Use `CMakeUserPresets.json` for local dev config (Git-ignored)
- **Generator:** Ninja on Linux, MSVC on Windows
- **C++ Standard:** C++17 minimum
- **Package Manager:** pixi (Python-based, cross-platform)
- **Toolchains:** Clang (default), GCC, MSVC (selectable via environments)
- **Tests:** Catch2 framework; add test executables to `test/CMakeLists.txt`
- **Docs:** Doxygen + m.css; build with `-t docs` target
- **Dependencies:** fmt (formatting library), catch2 (testing)

## Development Workflow

1. Activate environment: `pixi shell -e dev-linux-clang` (or your preferred toolchain)
2. Configure is already set up via `CMakeUserPresets.json`
3. Run: `pixi run build` (or `pixi run -e dev-linux-clang build`)
4. Edit code following style guidelines (run `format-fix` after)
5. Test: `ctest --test-dir build/dev` or single test via `-R` filter
6. Lint: clang-tidy runs automatically; check via build output
7. Commit: ensure `format-check` passes (part of CI workflow)

## Building Conda Packages with pixi-build (Rattler-Build)

This project uses **pixi-build** with the **rattler-build** backend for building conda packages.

### Recipe Structure

The `recipe/` directory uses a **unified recipe with variant files**:

| File | Purpose |
|------|---------|
| `recipe.yaml` | Unified recipe using `${{ compiler() }}` jinja functions |
| `variants.yaml` | Default variants (Clang) - used by `pixi build` |
| `variants-linux-clang.yaml` | Linux + Clang 18 |
| `variants-linux-gcc.yaml` | Linux + GCC 13 |
| `variants-win-clang.yaml` | Windows + Clang 18 |
| `variants-win-msvc.yaml` | Windows + MSVC 2022 |

### Building Packages

```bash
# Build with pixi (uses default Clang variant)
pixi build

# Build with specific toolchain variant
rattler-build build -r recipe/recipe.yaml --variant-config recipe/variants-linux-gcc.yaml
rattler-build build -r recipe/recipe.yaml --variant-config recipe/variants-win-msvc.yaml
```

### Why This Approach?

1. **Single Recipe**: One `recipe.yaml` instead of duplicated per-toolchain recipes
2. **Flexible Toolchains**: Variant files control compiler selection
3. **pixi-build Integration**: `pixi build` works out of the box
4. **CI-Ready**: Easy to build different variants in CI pipelines