schema_version: 1

package:
  name: template-cpp-project
  version: "0.1.0"

source:
  path: ..

build:
  number: 0
  script:
    - |
      # DPC++ (SYCL) specific environment setup
      export CC="${BUILD_PREFIX}/bin/clang"
      export CXX="${BUILD_PREFIX}/bin/clang++"
      export MKLROOT="${PREFIX}"
      export OCL_ICD_VENDORS="${PREFIX}/etc/OpenCL/vendors"
      
      # Set up build directories
      mkdir -p build
      
      # Configure with CMake
      # Note: DPC++ uses its own toolchain file, not the standard CMAKE_ARGS
      cmake -B build -S . \
        -GNinja \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX="${PREFIX}" \
        -DCMAKE_CXX_STANDARD=17 \
        -DCMAKE_TOOLCHAIN_FILE="${BUILD_PREFIX}/lib/cmake/clang.cmake" \
        -Dtemplate-cpp-project_DEVELOPER_MODE=OFF
      
      # Build
      cmake --build build --config Release
      
      # Install
      cmake --install build --config Release

requirements:
  build:
    # Build tools
    - cmake >=3.24,<4
    - ninja >=1.12.1,<2
    - ccache >=4.10.1,<5
    - pkg-config >=0.29.2,<0.30
    # DPC++ toolchain from NAGAGroup channel
    - naga-llvm-compute-toolkit >=2025.0.0
  host:
    # Host dependencies (libraries needed at runtime)
    - fmt >=11.0.2,<12

  run:
    # Runtime dependencies (what the package needs to run)
    - fmt >=11.0.2,<12

tests:
  - package_contents:
      # Verify the library and CMake files were installed
      files:
        - lib/libtemplate-cpp-project.a
        - lib/cmake/template-cpp-project/template-cpp-projectConfig.cmake
        - lib/cmake/template-cpp-project/template-cpp-projectTargets.cmake
