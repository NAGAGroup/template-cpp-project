schema_version: 1

package:
  name: template-cpp-project
  version: "0.1.0"

source:
  path: ..

build:
  number: 0
  string: clang_build
  script:
    - |
      # Set up compiler environment variables (Clang)
      export CC="${BUILD_PREFIX}/bin/clang"
      export CXX="${BUILD_PREFIX}/bin/clang++"
      
      # Set up GCC compatibility (Clang uses GCC headers)
      gcc_version=$(gcc -dumpversion)
      gcc_install_dir="${PREFIX}/lib/gcc/${CONDA_TOOLCHAIN_HOST}/${gcc_version}"
      export GCC_INSTALL_DIR="${gcc_install_dir}"
      
      # Set up build directories
      mkdir -p build
      
      # Configure with CMake
      cmake -B build -S . \
        -GNinja \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX="${PREFIX}" \
        -DCMAKE_CXX_STANDARD=17 \
        -DCMAKE_CXX_FLAGS="-Wall -Wextra -Wpedantic -Wconversion -Wsign-conversion -Wcast-qual -Wformat=2 -Wundef" \
        -DTEMPLATE_CPP_PROJECT_DEVELOPER_MODE=ON
      
      # Build
      cmake --build build --config Release
      
      # Install
      cmake --install build --config Release

requirements:
  build:
    # Build tools
    - cmake >=3.24,<4
    - ninja >=1.12.1,<2
    - ccache >=4.10.1,<5
    - pkg-config >=0.29.2,<0.30
    # Clang compiler
    - clangdev >=18.1.8,<20
    - clangxx_linux-64 >=18,<19  # [linux64]
    - clang_linux-64 >=18,<19    # [linux64]
  host:
    - fmt >=11.0.2,<12
  run:
    - fmt >=11.0.2,<12

tests:
  - script:
      - template-cpp-project_test --version
    requirements:
      run:
        - catch2 >=3.7.1,<4
        - template-cpp-project
